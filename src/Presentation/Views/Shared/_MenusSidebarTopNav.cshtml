@* Menú lateral y barra superior compartida - Se incluye desde _LayoutDashboard *@

<!-- Sidebar -->
<aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <i class="fas fa-city fa-2x mb-2"></i>
        <h4>Gestión Municipal</h4>
    </div>
    <ul class="sidebar-menu">
        <li class="menu-item">
            <a href="@Url.Action("Index", "Dashboard")" class="menu-link active">
                <i class="menu-icon fas fa-home"></i>
                <span class="menu-text">Dashboard</span>
            </a>
        </li>
        
        <!-- CONFIGURACIONES -->
        <li class="menu-item">
            <a href="#" class="menu-link has-submenu" onclick="toggleSubmenu(event, 'configuracion-menu')">
                <i class="menu-icon fas fa-cog"></i>
                <span class="menu-text">Configuración</span>
            </a>
            <ul class="submenu" id="configuracion-menu">
                <!-- ALCALDÍA -->
                <li class="menu-item">
                    <a href="#" class="menu-link has-submenu" onclick="toggleSubmenu(event, 'alcaldia-menu')">
                        <i class="menu-icon fas fa-landmark"></i>
                        <span class="menu-text">Alcaldía</span>
                    </a>
                    <ul class="submenu" id="alcaldia-menu">
                        <li class="menu-item">
                            <a href="@Url.Action("Index", "Alcaldias")" class="menu-link">
                                <i class="menu-icon fas fa-building"></i>
                                <span class="menu-text">Alcaldías</span>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="@Url.Action("Index", "Alcaldes")" class="menu-link">
                                <i class="menu-icon fas fa-user-tie"></i>
                                <span class="menu-text">Alcaldes</span>
                            </a>
                        </li>
                    </ul>
                </li>

                <!-- ESTRUCTURA ORGANIZACIONAL -->
                <li class="menu-item">
                    <a href="#" class="menu-link has-submenu" onclick="toggleSubmenu(event, 'estructura-menu')">
                        <i class="menu-icon fas fa-sitemap"></i>
                        <span class="menu-text">Estructura Organizacional</span>
                    </a>
                    <ul class="submenu" id="estructura-menu">
                        <li class="menu-item">
                            <a href="@Url.Action("Index", "Secretarias")" class="menu-link">
                                <i class="menu-icon fas fa-briefcase"></i>
                                <span class="menu-text">Secretarías</span>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="@Url.Action("Index", "Subsecretarias")" class="menu-link">
                                <i class="menu-icon fas fa-building"></i>
                                <span class="menu-text">Subsecretarías</span>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="@Url.Action("Index", "Responsables")" class="menu-link">
                                <i class="menu-icon fas fa-user-friends"></i>
                                <span class="menu-text">Responsables</span>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="@Url.Action("Index", "Departamentos")" class="menu-link">
                                <i class="menu-icon fas fa-map-marked-alt"></i>
                                <span class="menu-text">Departamentos</span>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="@Url.Action("Index", "Municipios")" class="menu-link">
                                <i class="menu-icon fas fa-city"></i>
                                <span class="menu-text">Municipios</span>
                            </a>
                        </li>
                    </ul>
                </li>

                <!-- JERARQUÍA ESTRATÉGICA -->
                <li class="menu-item">
                    <a href="#" class="menu-link has-submenu" onclick="toggleSubmenu(event, 'jerarquia-menu')">
                        <i class="menu-icon fas fa-layer-group"></i>
                        <span class="menu-text">Jerarquía Estratégica</span>
                    </a>
                    <ul class="submenu" id="jerarquia-menu">
                        <li class="menu-item">
                            <a href="@Url.Action("Index", "LineasEstrategicas")" class="menu-link">
                                <i class="menu-icon fas fa-chess"></i>
                                <span class="menu-text">Líneas Estratégicas</span>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="@Url.Action("Index", "Sectores")" class="menu-link">
                                <i class="menu-icon fas fa-industry"></i>
                                <span class="menu-text">Sectores</span>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="@Url.Action("Index", "Programas")" class="menu-link">
                                <i class="menu-icon fas fa-tasks"></i>
                                <span class="menu-text">Programas</span>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="@Url.Action("Index", "Productos")" class="menu-link">
                                <i class="menu-icon fas fa-box"></i>
                                <span class="menu-text">Productos</span>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="@Url.Action("Index", "Indicadores")" class="menu-link">
                                <i class="menu-icon fas fa-chart-line"></i>
                                <span class="menu-text">Indicadores</span>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="@Url.Action("Index", "Proyectos")" class="menu-link">
                                <i class="menu-icon fas fa-project-diagram"></i>
                                <span class="menu-text">Proyectos</span>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="@Url.Action("Index", "Actividades")" class="menu-link">
                                <i class="menu-icon fas fa-clipboard-list"></i>
                                <span class="menu-text">Actividades</span>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="@Url.Action("Index", "Evidencias")" class="menu-link">
                                <i class="menu-icon fas fa-file-upload"></i>
                                <span class="menu-text">Evidencias</span>
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="menu-item">
                    <a href="@Url.Action("Index", "Vigencias")" class="menu-link">
                        <i class="menu-icon fas fa-calendar-alt"></i>
                        <span class="menu-text">Vigencias</span>
                    </a>
                </li>

                <li class="menu-item">
                    <a href="#" class="menu-link has-submenu" onclick="toggleSubmenu(event, 'ods-menu')">
                        <i class="menu-icon fas fa-globe"></i>
                        <span class="menu-text">ODS</span>
                    </a>
                    <ul class="submenu" id="ods-menu">
                        <li class="menu-item">
                            <a href="@Url.Action("Index", "ODS")" class="menu-link">
                                <i class="menu-icon fas fa-globe"></i>
                                <span class="menu-text">ODS</span>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="@Url.Action("Index", "MetasODS")" class="menu-link">
                                <i class="menu-icon fas fa-bullseye"></i>
                                <span class="menu-text">Metas ODS</span>
                            </a>
                        </li>
                    </ul>
                </li>

                <!-- PLANES -->
                <li class="menu-item">
                    <a href="#" class="menu-link has-submenu" onclick="toggleSubmenu(event, 'planes-menu')">
                        <i class="menu-icon fas fa-file-alt"></i>
                        <span class="menu-text">Planes</span>
                    </a>
                    <ul class="submenu" id="planes-menu">
                        <li class="menu-item">
                            <a href="@Url.Action("Index", "PlanesNacionales")" class="menu-link">
                                <i class="menu-icon fas fa-flag"></i>
                                <span class="menu-text">Planes Nacionales</span>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="@Url.Action("Index", "PlanesDepartamentales")" class="menu-link">
                                <i class="menu-icon fas fa-map-marked-alt"></i>
                                <span class="menu-text">Planes Departamentales</span>
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="@Url.Action("Index", "PlanesMunicipales")" class="menu-link">
                                <i class="menu-icon fas fa-city"></i>
                                <span class="menu-text">Planes Municipales</span>
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </li>

        <!-- SEGURIDAD -->
        <li class="menu-item">
            <a href="#" class="menu-link has-submenu" onclick="toggleSubmenu(event, 'seguridad-menu')">
                <i class="menu-icon fas fa-shield-alt"></i>
                <span class="menu-text">Seguridad</span>
            </a>
            <ul class="submenu" id="seguridad-menu">
                <li class="menu-item">
                    <a href="@Url.Action("Index", "Usuarios")" class="menu-link">
                        <i class="menu-icon fas fa-users"></i>
                        <span class="menu-text">Usuarios</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="@Url.Action("Index", "Roles")" class="menu-link">
                        <i class="menu-icon fas fa-user-tag"></i>
                        <span class="menu-text">Roles</span>
                    </a>
                </li>
            </ul>
        </li>
    </ul>
</aside>

<!-- Main Content -->
<main class="main-content" id="mainContent">
    <!-- Top Navbar -->
    <nav class="top-navbar">
        <button class="toggle-btn" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>

        <div class="user-menu">
            <div class="user-info">
                <p class="user-name">@ViewBag.NombreUsuario</p>
                <p class="user-role">@(User.IsInRole("Administrador") ? "Administrador" : "Usuario")</p>
            </div>

            <!-- Selector de Tema de Color -->
            <div class="dropdown theme-selector">
                <button class="btn btn-light" type="button" data-bs-toggle="dropdown" title="Tema de Color">
                    <i class="fas fa-palette fa-lg"></i>
                </button>
                <div class="dropdown-menu dropdown-menu-end">
                    <div class="theme-color-grid">
                        <div class="theme-color-option" data-theme="default" title="Azul (Por defecto)"></div>
                        <div class="theme-color-option" data-theme="purple" title="Púrpura"></div>
                        <div class="theme-color-option" data-theme="blue" title="Azul Oscuro"></div>
                        <div class="theme-color-option" data-theme="green" title="Verde"></div>
                        <div class="theme-color-option" data-theme="orange" title="Naranja"></div>
                        <div class="theme-color-option" data-theme="red" title="Rojo"></div>
                        <div class="theme-color-option" data-theme="turquoise" title="Turquesa"></div>
                        <div class="theme-color-option" data-theme="yellow" title="Amarillo"></div>
                        <div class="theme-color-option" data-theme="slate" title="Gris Azulado"></div>
                        <div class="theme-color-option" data-theme="indigo" title="Índigo"></div>
                        <div class="theme-color-option" data-theme="pink" title="Rosa"></div>
                        <div class="theme-color-option" data-theme="teal" title="Verde Azulado"></div>
                    </div>
                </div>
            </div>

            <div class="dropdown">
                <button class="btn btn-light d-flex align-items-center gap-2" type="button"
                    data-bs-toggle="dropdown">
                    @if (!string.IsNullOrEmpty(ViewBag.FotoPerfilBase64))
                    {
                        <div class="user-avatar-nav">
                            <img src="data:image/jpeg;base64,@ViewBag.FotoPerfilBase64" alt="Foto de perfil" />
                        </div>
                    }
                    else
                    {
                        <div class="user-avatar-nav">
                            @{
                                var nombreCompleto = ViewBag.NombreUsuario?.ToString() ?? "Usuario";
                                var palabras = nombreCompleto.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                                var iniciales = "";
                                for (int i = 0; i < Math.Min(palabras.Length, 2); i++)
                                {
                                    if (palabras[i].Length > 0)
                                    {
                                        iniciales += palabras[i][0];
                                    }
                                }
                            }
                            <span>@iniciales</span>
                        </div>
                    }
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li><a class="dropdown-item" asp-action="Perfil" asp-controller="Usuarios"><i
                                class="fas fa-user me-2"></i>Mi Perfil</a></li>
                    <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i>Configuración</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li>
                        <form method="post" asp-action="Logout" asp-controller="Auth">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="dropdown-item">
                                <i class="fas fa-sign-out-alt me-2"></i>Cerrar Sesión
                            </button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Content Area - Se incluye desde el layout principal -->